<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Parsa Idehpour">
<meta name="dcterms.date" content="2025-12-17">
<meta name="description" content="Biological organisms are soft, compliant, and morphologically intelligent. Rigid robots miss half the design space.">

<title>Soft Machines: What Biology Teaches Robotics About Materials and Morphology – My Explorations with LLMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-0b37c64f34216b628666a8dac638b53b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Explorations with LLMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Parsa Idehpour</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Soft Machines: What Biology Teaches Robotics About Materials and Morphology</h1>
                  <div>
        <div class="description">
          Biological organisms are soft, compliant, and morphologically intelligent. Rigid robots miss half the design space.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">robotics</div>
                <div class="quarto-category">biology</div>
                <div class="quarto-category">soft-robotics</div>
                <div class="quarto-category">biomimetics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Parsa Idehpour </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 17, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Traditional robotics builds rigid machines: stiff links, precise joints, and high-gear-ratio motors. This approach has produced industrial arms that weld cars with micron-level accuracy and surgical robots that operate inside the human body. But it’s a strange design choice if you look at biology.</p>
<p>Living organisms are soft. Muscles are compliant. Skin stretches. Tendons store energy. Octopuses squeeze through cracks. Elephants manipulate objects with trunks. Evolution discovered that compliance isn’t a bug—it’s a feature.</p>
<p>This post explores soft robotics: the attempt to import biological insights about materials, morphology, and compliant control into engineered systems.</p>
<section id="the-stiffness-spectrum" class="level2">
<h2 class="anchored" data-anchor-id="the-stiffness-spectrum">The Stiffness Spectrum</h2>
<p>Materials have a property called Young’s modulus—a measure of stiffness. Steel has a modulus of about 200 GPa. Rubber is around 0.01-0.1 GPa. Biological tissues range from 1 kPa (brain tissue) to 1 GPa (bone), spanning six orders of magnitude.</p>
<p>Traditional robots operate at the stiff end: aluminum, steel, carbon fiber. Soft robotics operates in the compliant regime: silicones, hydrogels, elastomers, and biological tissues.</p>
<p>Why does stiffness matter?</p>
<p><strong>Rigid systems</strong> are good at: - Precise positioning (no deformation under load) - High force output (stiff transmissions don’t absorb energy) - Repeatable motion (geometrically predictable)</p>
<p><strong>Compliant systems</strong> are good at: - Conforming to irregular surfaces - Absorbing impact without damage - Safe interaction with humans and fragile objects - Exploiting passive dynamics to reduce control complexity</p>
<p>Most real-world tasks require some of each. Picking up an egg requires enough force to lift it but enough compliance to not crush it. Walking requires legs that are stiff enough to support body weight but compliant enough to absorb ground impact.</p>
</section>
<section id="morphological-computation" class="level2">
<h2 class="anchored" data-anchor-id="morphological-computation">Morphological Computation</h2>
<p>Here’s a striking insight: sometimes the “control” problem is best solved by changing the body rather than the brain.</p>
<p>Consider a passive dynamic walker—a simple mechanical linkage that walks down a slope with no motors and no computation. The dynamics of the system, properly tuned, produce walking “for free.” The intelligence is in the morphology.</p>
<p>Octopus arms are a biological example. Each arm has about 500 million neurons—more than the central brain. Much of the control is distributed into the arm itself. The arm “knows how” to reach and grasp without detailed commands from above. The morphology does the computation.</p>
<p>Soft robotics enables similar tricks:</p>
<ul>
<li><strong>Pneumatic grippers</strong> conform to object shapes automatically—no object recognition or grasp planning required</li>
<li><strong>Fin-ray effect</strong> grippers wrap around objects using simple structural geometry</li>
<li><strong>Passive compliant joints</strong> absorb disturbances that would destabilize a rigid system</li>
</ul>
<p>The implication: instead of sensing everything and computing the perfect action, design the body so that simple actions produce good outcomes across a range of conditions. Morphological computation is a form of generalization built into the hardware.</p>
</section>
<section id="actuator-technologies" class="level2">
<h2 class="anchored" data-anchor-id="actuator-technologies">Actuator Technologies</h2>
<p>Soft robots need soft actuators. The classic motor-and-gearbox doesn’t work when everything is squishy. Several alternative technologies have emerged:</p>
<p><strong>Pneumatic actuators</strong> use air pressure to inflate elastomeric chambers. Common designs include McKibben muscles (braided tubes that contract when pressurized) and pneu-nets (networks of channels that bend when inflated). Pneumatics can be fast and powerful, but they require bulky external compressors.</p>
<p><strong>Dielectric elastomer actuators (DEAs)</strong> are essentially compliant capacitors. When voltage is applied, electrostatic forces squeeze the elastomer, causing it to expand in area. DEAs are fast, efficient, and fully solid-state, but they require high voltages (kilovolts) and are prone to electrical breakdown.</p>
<p><strong>Shape memory alloys (SMAs)</strong> are wires that contract when heated (nickel-titanium is the most common). They’re simple, silent, and compact, but slow to cool, energy-inefficient, and limited in strain.</p>
<p><strong>Cable-driven systems</strong> keep stiff motors off the moving parts and transmit forces through tendons. This is how muscles work: the motor (muscle belly) is separated from the end-effector (hand) by compliant tendons.</p>
<p>None of these match the power density, efficiency, and control bandwidth of biological muscle. Making artificial muscle remains an open grand challenge.</p>
</section>
<section id="bio-hybrid-systems" class="level2">
<h2 class="anchored" data-anchor-id="bio-hybrid-systems">Bio-Hybrid Systems</h2>
<p>If we can’t build good artificial muscle, why not just use real muscle? Bio-hybrid robotics integrates living cells into engineered scaffolds.</p>
<p>Examples include:</p>
<ul>
<li><strong>Cardiomyocyte-powered swimmers</strong>: Thin films seeded with heart muscle cells that swim when the cells contract rhythmically</li>
<li><strong>Xenobots</strong>: Self-assembling organisms made from frog embryo cells, designed computationally and grown in labs</li>
<li><strong>Muscle-actuated grippers</strong>: Engineered tissue constructs that contract in response to electrical stimulation</li>
</ul>
<p>Bio-hybrid systems inherit the remarkable properties of living tissue: self-healing, efficient energy conversion, graceful degradation. But they also inherit biological limitations: cells die, require nutrients, and operate in narrow environmental conditions.</p>
<p>This field is more proof-of-concept than practical engineering at this point, but it hints at a distant future where the boundary between organism and machine is blurred by design.</p>
</section>
<section id="variable-stiffness-and-impedance-control" class="level2">
<h2 class="anchored" data-anchor-id="variable-stiffness-and-impedance-control">Variable Stiffness and Impedance Control</h2>
<p>Sometimes you need to be stiff; sometimes you need to be soft. Variable stiffness mechanisms let robots switch between modes.</p>
<p><strong>Series elastic actuators (SEAs)</strong> put a spring between the motor and the load. The spring provides passive compliance, absorbs shocks, and enables force sensing. By adjusting motor position, the effective stiffness can be modulated.</p>
<p><strong>Antagonistic designs</strong> (like biceps and triceps) use two actuators pulling against each other. Co-contracting both increases stiffness; relaxing both decreases it. This is how animals control joint impedance.</p>
<p><strong>Jamming-based mechanisms</strong> use granular material (like coffee grounds) in a membrane. When a vacuum is applied, the grains jam together and the structure becomes rigid. Release the vacuum and it’s soft again. This enables grippers that conform to objects, then lock in place.</p>
<p>Impedance control—regulating the relationship between motion and force rather than just position—is the natural control framework for these systems. You specify how the robot should feel to the environment, not exactly where it should be.</p>
</section>
<section id="case-studies" class="level2">
<h2 class="anchored" data-anchor-id="case-studies">Case Studies</h2>
<p><strong>Harvard’s soft gripper</strong>: A simple pneumatic gripper with three fingers that can pick up fragile objects—tomatoes, eggs, paper cups—without damage. The gripper succeeds not because of complex sensing and control but because compliance is built into the structure. The fingers conform to whatever they encounter.</p>
<p><strong>Xenobots</strong>: Computational design meets developmental biology. Algorithms search over possible arrangements of frog cells; selected designs are then grown from embryonic tissue. The resulting “organisms” can move, heal, and (surprisingly) reproduce by sweeping up loose cells into new xenobots. They blur every category boundary between living and artificial.</p>
<p><strong>Self-healing robots</strong>: Some soft materials can recover from damage. Cut a silicone actuator, and it might partial re-bond. More advanced materials incorporate microcapsules of healing agent or reversible chemical bonds that let the material repair itself. This is nowhere near biological regeneration, but it’s a start.</p>
<p><strong>Vine robots</strong>: Tubes that grow from the tip by inverting material from inside, like a self-inflating party horn. They can navigate through cluttered environments without pushing obstacles aside, useful for search-and-rescue or medical applications.</p>
</section>
<section id="trade-offs-and-open-problems" class="level2">
<h2 class="anchored" data-anchor-id="trade-offs-and-open-problems">Trade-offs and Open Problems</h2>
<p>Soft robotics involves fundamental trade-offs:</p>
<p><strong>Precision vs.&nbsp;compliance</strong>: Soft systems inherently sacrifice positional accuracy. You can’t place a soft arm with sub-millimeter precision because it deforms under gravity and contact forces.</p>
<p><strong>Control complexity vs.&nbsp;robustness</strong>: Soft bodies have infinite degrees of freedom (every point can move). You can’t measure or control all of them. This makes classical control theory largely inapplicable, but it also means the system naturally absorbs perturbations that would destabilize a rigid robot.</p>
<p><strong>Fabrication and repair</strong>: Soft robots are often molded rather than machined, requiring different manufacturing processes. Integrating sensors and electronics with soft bodies remains a challenge.</p>
<p><strong>Modeling</strong>: Soft robots don’t follow rigid-body dynamics. They require continuum mechanics, which is computationally expensive and harder to learn from data.</p>
<p>Despite these challenges, soft robotics is advancing rapidly. As manufacturing improves, as materials science progresses, and as learning algorithms become capable of handling high-dimensional compliant systems, we’ll see soft robots move from labs into the real world.</p>
</section>
<section id="why-it-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-it-matters">Why It Matters</h2>
<p>Soft robotics isn’t just a curiosity—it’s necessary for many applications:</p>
<ul>
<li><strong>Human-robot interaction</strong>: Rigid robots are dangerous near people. Compliant robots are inherently safer.</li>
<li><strong>Unstructured environments</strong>: Earth’s surface (and most of the universe) is soft, irregular, and unpredictable. Rigid robots struggle; soft robots conform.</li>
<li><strong>Medical devices</strong>: The body is soft. Surgical instruments, prosthetics, and implants that match tissue compliance integrate better.</li>
<li><strong>Agriculture</strong>: Produce is fragile. Soft grippers can harvest delicate crops without damage.</li>
</ul>
<p>Biology has been running the soft robotics experiment for billions of years. Every animal is proof that compliant, integrative, morphologically intelligent systems can achieve remarkable performance. Robotics is finally beginning to learn from that example.</p>
<div style="text-align:center;">
  <img src="image.png" alt="Figure" width="65%">
  <p><em>Figure 1. Rigid vs. soft robotic grippers: conforming contact distributes force</em></p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/ParsaIdp\.github\.io\/comm4190_F25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>